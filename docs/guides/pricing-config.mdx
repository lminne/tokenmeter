---
title: "Pricing Configuration"
description: "Control how Tokenmeter calculates costs"
---

Tokenmeter calculates costs using a pricing manifest—a JSON file with per-model pricing. By default, it uses bundled pricing with optional remote updates.

## How Pricing Works

1. **Bundled pricing** — Compiled at build time from provider pricing pages
2. **Remote refresh** — Fetches updates from a pricing API on startup
3. **Local cache** — Caches remote pricing for 5 minutes
4. **Fallback** — Uses bundled pricing if remote fetch fails

```mermaid
flowchart TD
    A[App starts] --> B{Remote fetch?}
    B -->|Success| C[Use remote pricing]
    B -->|Failure| D[Use bundled pricing]
    C --> E[Cache for 5min]
    E --> F[Calculate costs]
    D --> F
```

## Offline Mode

Disable remote fetching to use only bundled pricing:

```typescript
import { configurePricing } from 'tokenmeter';

configurePricing({ offlineMode: true });
```

Use this when:
- Running in environments without internet access
- You want deterministic pricing (no remote updates)
- You're testing and don't want network calls

## Custom Pricing API

Point to your own pricing API:

```typescript
configurePricing({
  apiUrl: 'https://your-api.com/pricing',
});
```

The API should return a manifest in this format:

```json
{
  "version": "1.0.0",
  "updatedAt": "2024-01-15T00:00:00Z",
  "providers": {
    "openai": {
      "gpt-4o": {
        "input": 2.50,
        "output": 10.00,
        "unit": "1m_tokens"
      }
    }
  }
}
```

Valid `unit` values are:
- `1m_tokens` — per million tokens (most LLMs)
- `1k_tokens` — per thousand tokens (legacy)
- `1k_characters` — per thousand characters (TTS)
- `request` — flat per-request
- `megapixel` — per megapixel (some image models)
- `second` — per second (video/audio)
- `minute` — per minute (transcription)
- `image` — per image generated

## Force Refresh

Manually refresh pricing data:

```typescript
import { loadManifest } from 'tokenmeter';

await loadManifest({ forceRefresh: true });
```

This bypasses the cache and fetches fresh data.

## Model Aliases

Map custom model names to known models for pricing lookup:

```typescript
import { setModelAliases, configurePricing } from 'tokenmeter';

// Option 1: Using setModelAliases (simpler for basic cases)
setModelAliases({
  // Fine-tuned models -> map to canonical pricing
  'ft:gpt-4o:my-org:custom:abc123': { provider: 'openai', model: 'gpt-4o' },
  
  // Custom deployment names
  'azure-gpt4': { provider: 'openai', model: 'gpt-4o' },
  'bedrock-claude': { provider: 'bedrock', model: 'anthropic.claude-sonnet-4-5' },
  
  // Internal model registry
  'llm-prod-v2': { provider: 'openai', model: 'gpt-4o' },
});

// Option 2: Provider-specific aliases (when same name used across providers)
setModelAliases({
  'openai:my-model': { provider: 'openai', model: 'gpt-4o-realtime' },
  'azure:my-model': { provider: 'azure', model: 'gpt-4o-azure' },
});

// Option 3: Using configurePricing (for validation at startup)
configurePricing({
  modelAliases: {
    'my-custom-model': { provider: 'openai', model: 'gpt-4o' },
  },
});
```

When Tokenmeter encounters an unknown model, it checks aliases before falling back to zero cost.

## Clear Aliases

Remove all aliases:

```typescript
import { clearModelAliases } from 'tokenmeter';

clearModelAliases();
```

## Get Current Aliases

View configured aliases:

```typescript
import { getModelAliases } from 'tokenmeter';

const aliases = getModelAliases();
console.log(aliases);
// { 'ft:gpt-4o:...': { provider: 'openai', model: 'gpt-4o' }, ... }
```

## Checking Pricing

Look up pricing for a specific model:

```typescript
import { getModelPricing } from 'tokenmeter';

const pricing = getModelPricing('openai', 'gpt-4o');

if (pricing) {
  console.log(`Input: $${pricing.input} per ${pricing.unit}`);
  console.log(`Output: $${pricing.output} per ${pricing.unit}`);
} else {
  console.log('Model not found in pricing manifest');
}
```

## Calculate Cost Manually

Calculate cost from usage data:

```typescript
import { calculateCost, getModelPricing, getCachedManifest } from 'tokenmeter';

// Get pricing for a model
const manifest = getCachedManifest();
const pricing = getModelPricing('openai', 'gpt-4o', manifest);

if (pricing) {
  // Calculate cost with usage data
  const cost = calculateCost(
    {
      inputUnits: 1500,  // tokens
      outputUnits: 500,
    },
    pricing
  );

  console.log(`Cost: $${cost.toFixed(6)}`);
}
```

### Multi-Modal Pricing (Images, Video, Audio)

For models with per-type pricing (like image generation with resolution variants):

```typescript
const pricing = getModelPricing('fal', 'gemini-3-pro-image-preview', manifest);

if (pricing) {
  const cost = calculateCost(
    {
      outputUnits: 4,
      usageByType: {
        'output_images_4k': 4,  // 4 images at 4K resolution
      },
    },
    pricing
  );
}
```

Common `usageByType` keys:
- `output_images`, `output_images_1k`, `output_images_2k`, `output_images_4k` — image generation
- `output_seconds`, `output_seconds_with_audio` — video generation
- `input_characters` — text-to-speech

## Cache Management

View cached manifest:

```typescript
import { getCachedManifest } from 'tokenmeter';

const manifest = getCachedManifest();
if (manifest) {
  console.log(`Version: ${manifest.version}`);
  console.log(`Updated: ${manifest.updatedAt}`);
}
```

Clear the cache:

```typescript
import { clearManifestCache } from 'tokenmeter';

clearManifestCache();
```

## Current Configuration

View current pricing configuration:

```typescript
import { getPricingConfig } from 'tokenmeter';

const config = getPricingConfig();
console.log(config);
// { offlineMode: false, apiUrl: 'https://...', cacheMs: 300000 }
```

## Pricing Units

Different providers use different pricing units:

| Provider | Unit | Example |
|----------|------|---------|
| OpenAI | per 1M tokens | `$2.50 / 1M input tokens` |
| Anthropic | per 1M tokens | `$3.00 / 1M input tokens` |
| fal.ai | varies | per request, per megapixel, per second |
| ElevenLabs | per 1K characters | `$0.30 / 1K chars` |

Tokenmeter normalizes these internally for consistent `cost_usd` values.

## Unknown Models

When Tokenmeter encounters an unknown model:

1. Checks model aliases
2. Tries partial matching (e.g., `gpt-4o-2024-05-13` → `gpt-4o`)
3. Falls back to zero cost with a warning log

```typescript
import { configureLogger } from 'tokenmeter';

// Enable warnings to see unknown model alerts
configureLogger({ level: 'warn' });
```

## Contributing Pricing Updates

If you notice outdated pricing:

1. Check the bundled manifest at `src/pricing/manifest.json`
2. Update with current pricing from provider pages
3. Submit a PR

See [Contributing](/resources/contributing).

